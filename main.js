!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e,t,s){},function(e,t,s){"use strict";s.r(t);s(0);class n{constructor(e,t,s,n,r,i){this._name=e.name,this._link=e.link,this._id=e._id,this._likes=e.likes,this._owner=e.owner,this._template=t,this._myId=n,this._openPopupWithImage=s,this._openPopupDeleteCard=r,this._api=i}_getTemplate(){return this._template.cloneNode(!0)}createCard(){this._element=this._getTemplate();const e=this._element.querySelector(".element__image"),t=this._element.querySelector(".element__text"),s=this._element.querySelector(".element");if(this._elementLike=this._element.querySelector(".element__like_place"),e.src=this._link,e.alt=this._name,t.textContent=this._name,s.id=this._id,this._likes.length>=1&&(this._elementLike.textContent=this._likes.length),this._owner._id===this._myId){const e=document.createElement("button");e.classList.add("element__delete","transition"),e.setAttribute("type","button"),this._element.querySelector(".element").appendChild(e),e.addEventListener("click",()=>{this._openPopupDeleteCard(this._id)})}return this._likes.forEach(e=>{if(e._id===this._myId){this._element.querySelector(".element__like").classList.add("element__like_clicked")}}),this._setCardListeners(e,t),this._element}_like(e){e.target.classList.contains("element__like_clicked")?this._api.deleteLike(this._id).then(t=>{e.target.classList.remove("element__like_clicked"),t.likes.length>=1?this._elementLike.textContent=t.likes.length:this._elementLike.textContent=""}).catch(e=>{console.log(e)}):this._api.putLike(this._id).then(t=>{e.target.classList.add("element__like_clicked"),this._elementLike.textContent=t.likes.length}).catch(e=>{console.log(e)})}_setCardListeners(e,t){this._element.querySelector(".element__like").addEventListener("click",e=>{this._like(e)}),this._element.querySelector(".element__image").addEventListener("click",()=>{this._openPopupWithImage(e,t)})}}class r{constructor({data:e,renderer:t},s){this._renderedItems=e,this._renderer=t,this._container=s}renderItems(){this._renderedItems.forEach(e=>this._renderer(e))}addItem(e){this._container.prepend(e)}addNewCard(e){this._container.prepend(e)}appendCard(e){this._container.append(e)}}class i{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t,this._formElement=document.querySelector(this._form)}_disableButtonState(){this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)}_enableButtonState(){this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled",!0)}_actualizeButtonState(){this._hasInvalidInput()?this._disableButtonState():this._enableButtonState()}_hasInvalidInput(){return this._inputList.some(e=>!e.validity.valid)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_showInputError(e){const t=this._element.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.classList.add(this._errorClass),t.textContent=e.validationMessage}_hideInputError(e){const t=this._element.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_resetForm(){const e=Array.from(this._element.querySelectorAll(".popup__input_type_error")),t=Array.from(this._element.querySelectorAll(".popup__error_visible"));e.forEach(e=>{e.classList.remove("popup__input_type_error")}),t.forEach(e=>{e.classList.remove("popup__error_visible")})}_setEventListeners(){this._inputList=Array.from(this._element.querySelectorAll(this._inputSelector)),this._buttonElement=this._element.querySelector(this._submitButtonSelector),this._actualizeButtonState(),this._resetForm(),this._inputList.forEach(e=>{e.addEventListener("input",()=>{this._checkInputValidity(e),this._actualizeButtonState()})})}enableValidation(){return this._element=this._formElement,this._element.addEventListener("submit",e=>{e.preventDefault()}),this._setEventListeners(),this._element}}const o={inputSelector:".popup__input",submitButtonSelector:".popup__button_type_submit",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};class a{constructor(e){this._popup=e}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keyup",e=>this._exitEscKey(e))}close(){this._popup.classList.remove("popup_opened"),this._popup.removeEventListener("click",this._click),document.removeEventListener("keyup",e=>this._exitEscKey(e))}_exitEscKey(e){"Escape"===e.key&&this.close()}setEventListeners(){this._closeButton=this._popup.querySelector(".popup__close"),this._closeButton.addEventListener("mousedown",()=>{this.close()}),this._popup.addEventListener("mousedown",e=>{e.target===e.currentTarget&&this.close()})}}class l extends a{constructor(e,t){super(e),this._formSubmit=t,this._form=this._popup.querySelector(".popup__form")}_getInputValues(){return this._inputList=this._form.querySelectorAll(".popup__input"),this._formValues={},this._inputList.forEach(e=>{this._formValues[e.name]=e.value}),this._formValues}setEventListeners(){super.setEventListeners(),this.submitButton=this._form.querySelector(".popup__submit"),this._form.addEventListener("submit",e=>{if(this.submitButton.classList.contains("popup__button_inactive"))return!1;e.preventDefault(),this._formSubmit(this._getInputValues())})}close(){super.close(),this._form.reset()}}const u=document.querySelector("#element").content,_=document.querySelector(".profile__button_edit"),c=document.querySelector(".popup_type_profile"),p=document.querySelector(".profile__fullname"),h=document.querySelector(".profile__subtitle"),d=document.querySelector(".popup__input_fullname"),m=document.querySelector(".popup__input_subtitle"),f=document.querySelector(".popup__button_type_info"),y=document.querySelector(".popup_type_photo"),v=document.querySelector(".popup__image"),b=document.querySelector(".popup__description"),S=document.querySelector(".elements__list"),g=document.querySelector(".popup_type_add-card"),E=document.querySelector(".profile__button_add"),L=document.querySelector(".popup__button_type_element"),k=document.querySelector(".profile__button_avatar"),C=document.querySelector(".popup_type_avatar"),I=document.querySelector(".popup__button_type_avatar"),q=document.querySelector(".popup_type_delete"),x=new i(o,'form[name="shape"]'),w=new i(o,'form[name="image"]'),B=new i(o,'form[name="avatar"]'),P=function(e,t){!0===e?t.textContent="Сохранение...":t.classList.contains("popup__button_type_place")?t.textContent="Создать":t.textContent="Сохранить"},A=new class{constructor({baseUrl:e,headers:t}){this.url=e,this.headers=t}getInitialCards(){return fetch(this.url+"/cards",{headers:{authorization:this.headers.authorization}}).then(e=>this._getResponseData(e))}getUserInfo(){return fetch(this.url+"/users/me",{headers:{authorization:this.headers.authorization}}).then(e=>this._getResponseData(e))}patchUserInfo(e,t){return console.log(e,t),fetch(this.url+"/users/me",{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})}).then(e=>this._getResponseData(e))}postNewCard(e,t){return fetch(this.url+"/cards",{method:"POST",headers:this.headers,body:JSON.stringify({name:e,link:t})}).then(e=>this._getResponseData(e))}putLike(e){return fetch(`${this.url}/cards/likes/${e}`,{method:"PUT",headers:{authorization:this.headers.authorization}}).then(e=>this._getResponseData(e))}deleteLike(e){return fetch(`${this.url}/cards/likes/${e}`,{method:"DELETE",headers:{authorization:this.headers.authorization}}).then(e=>this._getResponseData(e))}deleteCard(e){return fetch(`${this.url}/cards/${e}`,{method:"DELETE",headers:{authorization:this.headers.authorization}}).then(e=>this._getResponseData(e))}patchAvatar(e){return fetch(this.url+"/users/me/avatar",{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).then(e=>this._getResponseData(e))}_getResponseData(e){return e.ok?e.json():Promise.reject(new Error("Ошибка: "+e.status))}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-14",headers:{authorization:"5cdb7fd9-798d-4617-8ae3-90459ea95534","Content-Type":"application/json"}});A.getUserInfo().then(e=>{A.userInfo=e,M.setUserInfo({name:e.name,about:e.about}),M.setAvatar(e.avatar),A.getInitialCards().then(e=>{O(e).renderItems()}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)});const D=new l(g,e=>{var t;t=e,P(!0,L),A.postNewCard(t.name,t.link).then(e=>{O().addNewCard(T(e)),D.close()}).catch(e=>{console.log(e)}).finally(()=>{P(!1,L)})}),z=new l(c,(function(e){P(!0,f),A.patchUserInfo(e.name,e.about).then(e=>{M.setUserInfo(e),z.close()}).catch(e=>{console.log(e)}).finally(()=>{P(!1,f)})})),U=new l(C,(function(e){P(!0,I),A.patchAvatar(e.avatar).then(e=>{M.setAvatar(e.avatar),U.close()}).catch(e=>{console.log(e)}).finally(()=>{P(!1,I)})})),T=function(e){return new n(e,u,j,A.userInfo._id,$,A).createCard()},O=function(e){const t=new r({data:e,renderer:e=>{t.appendCard(T(e))}},S);return t},V=new class extends a{constructor(e,t,s){super(e),this._imageInPopup=t,this._textInPopup=s}open(e,t){super.open(),this._imageInPopup.src=e.src,this._imageInPopup.alt=e.alt,this._textInPopup.textContent=t.textContent}}(y,v,b),j=function(e,t){V.open(e,t),V.setEventListeners()},R=new l(c,()=>{M.setUserInfo(d,m)}),N=new class extends a{constructor(e,t){super(e),this._api=t}setEventListeners(e){super.setEventListeners();this._popup.querySelector(".popup__submit").addEventListener("click",()=>{this._deleteClickHandler(e)})}_deleteClickHandler(e){this._api.deleteCard(e).then(t=>{document.getElementById(e).remove(),this.close(),console.log(t)}).catch(e=>{console.log(e)})}}(q,A),$=function(e){N.open(),N.setEventListeners(e)},M=new class{constructor({fullname:e,subtitle:t}){this._fullname=e,this._subtitle=t}getUserInfo(){return{fullname:this._fullname.textContent,subtitle:this._subtitle.textContent}}setUserInfo({name:e,about:t}){this._fullname.textContent=e,this._subtitle.textContent=t}setAvatar(e){document.querySelector(".profile__avatar").style.backgroundImage="url("+e+")"}}({fullname:p,subtitle:h});D.setEventListeners(),z.setEventListeners(),U.setEventListeners(),_.addEventListener("click",()=>{console.log(x,"profile");const e=M.getUserInfo();d.value=e.fullname,m.value=e.subtitle,R.open(),x.enableValidation()}),E.addEventListener("click",()=>{console.log(w,"add"),D.open(),w.enableValidation()}),k.addEventListener("click",()=>{U.open(),B.enableValidation()})}]);